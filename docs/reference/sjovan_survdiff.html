<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Doubly robust estimation of the survival curves in two exposure groups
and their difference using the method of Sjolander and Vansteelandt (2017) ."><title>Estimate the survival curves in two treatment groups — sjovan_survdiff • drsurv</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate the survival curves in two treatment groups — sjovan_survdiff"><meta property="og:description" content="Doubly robust estimation of the survival curves in two exposure groups
and their difference using the method of Sjolander and Vansteelandt (2017) ."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">drsurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/comparison.html">Comparison of Methods in the Rotterdam Data</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sachsmc/drsurv/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate the survival curves in two treatment groups</h1>
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/drsurv/blob/HEAD/R/drkm.R" class="external-link"><code>R/drkm.R</code></a></small>
      <div class="d-none name"><code>sjovan_survdiff.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Doubly robust estimation of the survival curves in two exposure groups
and their difference using the method of Sjolander and Vansteelandt (2017) .</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sjovan_survdiff</span><span class="op">(</span></span>
<span>  oformula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ofunc <span class="op">=</span> <span class="st">"survreg"</span>,</span>
<span>  oarg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cformula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cfunc <span class="op">=</span> <span class="st">"survreg"</span>,</span>
<span>  carg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  eformula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  earg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"DR"</span>,</span>
<span>  times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rel.tol <span class="op">=</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">^</span><span class="fl">0.1</span>,</span>
<span>  jacobian.method <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>  se.type <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  parallel <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ncpus <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>oformula</dt>
<dd><p>The outcome formula, the left side should be a call to <a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></p></dd>


<dt>ofunc</dt>
<dd><p>The model type for the outcome, one of "coxph" or "survreg"</p></dd>


<dt>oarg</dt>
<dd><p>Arguments passed to <code>ofunc</code></p></dd>


<dt>cformula</dt>
<dd><p>The censoring model formula, the left side should be a call to <a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></p></dd>


<dt>cfunc</dt>
<dd><p>The model type for the censoring model, either "coxph" or "survreg"</p></dd>


<dt>carg</dt>
<dd><p>Arguments passed to <code>cfunc</code></p></dd>


<dt>eformula</dt>
<dd><p>The exposure model formula, which will be fit by logistic regression in a call to <a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></p></dd>


<dt>earg</dt>
<dd><p>Arguments passed to the glm for the exposure model</p></dd>


<dt>method</dt>
<dd><p>Estimation method, either "IPW" or "DR"</p></dd>


<dt>times</dt>
<dd><p>Vector of times at which to estimate the survival curves</p></dd>


<dt>rel.tol</dt>
<dd><p>Convergence tolerance</p></dd>


<dt>jacobian.method</dt>
<dd><p>Method of computing the jacobian, passed to <a href="https://rdrr.io/pkg/numDeriv/man/jacobian.html" class="external-link">jacobian</a></p></dd>


<dt>se.type</dt>
<dd><p>Method of calculating standard errors, either "none" for no standard errors, "sandwich", or "boot"</p></dd>


<dt>data</dt>
<dd><p>Data frame in which to find the variables in the model formulas</p></dd>


<dt>weights</dt>
<dd><p>Vector of case weights</p></dd>


<dt>subset</dt>
<dd><p>Logical vector</p></dd>


<dt>R</dt>
<dd><p>Number of bootstrap replicates, used if <code>se.type = "boot"</code></p></dd>


<dt>parallel</dt>
<dd><p>Parallel processing for bootstrap, see <a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></p></dd>


<dt>cl</dt>
<dd><p>Optional cluster if parallel processing, see <a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></p></dd>


<dt>ncpus</dt>
<dd><p>Number of cpus to use for parallel processing, see <a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with the estimates survival probabilities in each group, their difference, and standard errors, if requested</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Following Bai et al. 2013 and Sjölander and Vansteelandt 2017, consider the
following estimating equation for \(S_x(t) = p\{T(x) &gt; t\}\):
$$\sum_{i = 1}^n \left[S_x(t) - \frac{I_{X_i = x}
I_{\tilde{T}_i &gt; t}}{\bar{g}(\boldsymbol{Z}_i, \boldsymbol{\alpha})G_c(t,
X_i, \boldsymbol{Z}_i)} - \frac{I_{X_i = x} - \bar{g}(\boldsymbol{Z}_i,
\boldsymbol{\alpha})}{\bar{g}(\boldsymbol{Z}_i, \boldsymbol{\alpha})} H(t,
\boldsymbol{Z}_i, X = x) - \right. \\ \left. \frac{I_{X_i = x} -
\bar{g}(\boldsymbol{Z}_i, \boldsymbol{\alpha})}{\bar{g}(\boldsymbol{Z}_i,
\boldsymbol{\alpha})} H(t, \boldsymbol{Z}_i, X = x) \int_0^t\frac{d\, M_c(u,
\boldsymbol{Z}_i, X_i, \tilde{T}_i, \Delta_i)}{G_c(u, X_i,
\boldsymbol{Z}_i)H(u, \boldsymbol{Z}_i, X_i)}\right] = 0, $$
where \(\bar{g}(\boldsymbol{Z}_i, \boldsymbol{\alpha}) = g(\boldsymbol{Z}_i,
\boldsymbol{\alpha})^x (1 - g(\boldsymbol{Z}_i,
\boldsymbol{\alpha}))^{(1-x)}\), \(H(t, \boldsymbol{Z}, X)\) is a model for
\(p\{T &gt; t | \boldsymbol{Z}, X\}\), and \(M_c(t, \boldsymbol{Z}, X, \tilde{T},
\Delta)\) is the martingale increment for the censoring distribution. The
above is an unbiased estimating equation for \(S_x(t)\) if either \(H(t,
\boldsymbol{Z}, X)\) is correctly specified for both censoring and
confounding, i.e., is a correctly specified model for \(p\{T(x) &gt; t |
\boldsymbol{Z}, X\}\) or both \(G_c(u, X, \boldsymbol{Z})\) and
\(g(\boldsymbol{Z}, \boldsymbol{\alpha})\) are correctly specified for
censoring and confounding, respectively. To obtain estimates of the
difference in survival probabilities, one must specify models for the unknown
functions \(g\), \(G_c\), and \(H\), get estimates of those, plug them
into the estimating equations, and solve for \(S_x(t)\) under \(x \in
\{0, 1\}\). In this package, one can use semiparametric Cox models or
parametric survival models for the outcome and the censoring distributions,
and logistic regression for the propensity score model. Bai et al. 2013
provide an expression for a variance estimator that accounts for the
uncertainty due to the estimation of the propensity score \(g\) and the
censoring distribution \(G_c\).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Xiaofei Bai, Anastasios A Tsiatis, and Sean~M O'Brien.
  "Doubly-robust estimators of treatment-specific survival distributions in
  observational studies with stratified sampling." Biometrics,
  69(4):830--839, 2013.</p>
<p>Sjölander, Arvid, and Stijn Vansteelandt. "Doubly
  robust estimation of attributable fractions in survival analysis."
  Statistical methods in medical research 26(2):948-969, 2017.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">rotterdam</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">rtime</span>, <span class="va">df</span><span class="op">$</span><span class="va">dtime</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365.25</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">recur</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">df</span><span class="op">$</span><span class="va">death</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">censor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">df</span><span class="op">$</span><span class="va">status</span></span></span>
<span class="r-in"><span><span class="va">drFit</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">sjovan_survdiff</span><span class="op">(</span></span></span>
<span class="r-in"><span>    oformula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">chemo</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="va">size</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">+</span> <span class="va">nodes</span> <span class="op">+</span> <span class="va">pgr</span> <span class="op">+</span> <span class="va">er</span> <span class="op">+</span> <span class="va">hormon</span>,</span></span>
<span class="r-in"><span>    ofunc <span class="op">=</span> <span class="st">"survreg"</span>,</span></span>
<span class="r-in"><span>    cformula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">censor</span><span class="op">)</span> <span class="op">~</span> <span class="va">chemo</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">age</span>,</span></span>
<span class="r-in"><span>    cfunc <span class="op">=</span> <span class="st">"survreg"</span>,</span></span>
<span class="r-in"><span>    eformula <span class="op">=</span> <span class="va">chemo</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span> <span class="va">size</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">+</span> <span class="va">nodes</span> <span class="op">+</span> <span class="va">pgr</span> <span class="op">+</span> <span class="va">er</span> <span class="op">+</span> <span class="va">hormon</span>,</span></span>
<span class="r-in"><span>    method <span class="op">=</span> <span class="st">"DR"</span>,</span></span>
<span class="r-in"><span>    times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">7.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    se.type <span class="op">=</span> <span class="st">"sandwich"</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">df</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">drFit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $est.S1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.7661741 0.6032550 0.5224925</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.S1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.03440273 0.02906199 0.14520126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $est.S0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.7190130 0.5515392 0.4670844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.S0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.07008758 0.07427899 0.10500988</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $est.diff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.04716109 0.05171581 0.05540801</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.diff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.06863352 0.07611256 0.14153032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michael C Sachs, Arvid Sjölander, Erin E Gabriel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

