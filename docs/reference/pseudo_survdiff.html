<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Doubly robust estimation of the survival probabilities in two exposure groups
and their difference using the method of Wang (2018). By default it is
assumed that censoring is completely independent, but covariate-dependence
can be modeled by either specifying the right side of cformula and cens.method which
will be passed to cumincglm."><title>Estimate the survival probabilities in two treatment groups at several times — pseudo_survdiff • drsurv</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate the survival probabilities in two treatment groups at several times — pseudo_survdiff"><meta property="og:description" content="Doubly robust estimation of the survival probabilities in two exposure groups
and their difference using the method of Wang (2018). By default it is
assumed that censoring is completely independent, but covariate-dependence
can be modeled by either specifying the right side of cformula and cens.method which
will be passed to cumincglm."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">drsurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/comparison.html">Comparison of Methods in the Rotterdam Data</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sachsmc/drsurv/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate the survival probabilities in two treatment groups at several times</h1>
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/drsurv/blob/HEAD/R/pseudoobs.R" class="external-link"><code>R/pseudoobs.R</code></a></small>
      <div class="d-none name"><code>pseudo_survdiff.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Doubly robust estimation of the survival probabilities in two exposure groups
and their difference using the method of Wang (2018). By default it is
assumed that censoring is completely independent, but covariate-dependence
can be modeled by either specifying the right side of <code>cformula</code> and <code>cens.method</code> which
will be passed to <a href="https://sachsmc.github.io/eventglm/reference/cumincglm.html" class="external-link">cumincglm</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pseudo_survdiff</span><span class="op">(</span></span>
<span>  <span class="va">oformula</span>,</span>
<span>  cformula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  cens.method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">eformula</span>,</span>
<span>  <span class="va">times</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  parallel <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ncpus <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>oformula</dt>
<dd><p>The outcome formula, the left side should be a call to <a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></p></dd>


<dt>cformula</dt>
<dd><p>The censoring model formula, a one sided formula with no outcome</p></dd>


<dt>cens.method</dt>
<dd><p>Method to use for the censoring model, passed to <a href="https://sachsmc.github.io/eventglm/reference/cumincglm.html" class="external-link">cumincglm</a></p></dd>


<dt>eformula</dt>
<dd><p>The exposure model formula, which will be fit by logistic regression in a call to <a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></p></dd>


<dt>times</dt>
<dd><p>Vector of times at which to estimate the survival probabilities</p></dd>


<dt>data</dt>
<dd><p>Data frame in which to find the variables in the model formulas</p></dd>


<dt>weights</dt>
<dd><p>Vector of case weights</p></dd>


<dt>subset</dt>
<dd><p>Logical vector</p></dd>


<dt>R</dt>
<dd><p>Number of bootstrap replicates for standard error</p></dd>


<dt>parallel</dt>
<dd><p>Parallel processing for bootstrap, see <a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></p></dd>


<dt>cl</dt>
<dd><p>Optional cluster if parallel processing, see <a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></p></dd>


<dt>ncpus</dt>
<dd><p>Number of cpus to use for parallel processing, see <a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with estimated survival probabilities in each group, their difference, and estimated standard errors.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>As presented in Wang 2018, let the jackknife pseudo observation for the $i$th
subject be $$\hat{S}^i(t) = n \hat{S}(t) - (n - 1)\hat{S}^{-i}(t),$$ where
\(\hat{S}(t)\) is an estimator of the survival probability at time \(t\)
using all \(n\) subjects, and \(\hat{S}^{-i}(t)\) is an estimator of the
survival probability at time \(t\) leaving the \(i\)th subject out of the
estimation procedure. The assumption about censoring is implied by the way
these pseudo observations are computed, i.e., these could be inverse
probability of censoring weighted estimators where the censoring distribution
may depend on covariates, nonparametric estimators stratified on covariates,
or simply the Kaplan-Meier estimators if censoring is assumed to be
independent of covariates. We then use a working outcome model for the
conditional survival probability:
$$\log[-\log\{v_i(X_i)\}]=\log[-\log\{p(T &gt; t | X_i, \boldsymbol{Z}_i)\}] =
\beta^\star X_i+h(X_i,\boldsymbol{Z}_i;\boldsymbol{\gamma}^\star),$$ where
\(\log(-\log(x))\) is the link function that coincides with how a
proportional hazards model fits survival at this time point. It is of note
that, unlike the Cox model, this estimator does not assume anything about the
survival function prior to time point \(t\). The parameters in the above
model are estimated by solving the generalized estimating equations with
\(\hat{S}^i(t)\) used as the
outcome variable. Let \(\hat{v}_i(x) = \exp[-\exp\{\hat{\beta}^\star
x+h(x,\boldsymbol{Z}_i;\hat{\boldsymbol{\gamma}}^\star)\}]\). A logistic regression model for the propensity of the exposure is assumed and estimated. The doubly robust
estimator of the difference in survival probability at time \(t\) is
$$\frac{1}{n}\sum_{i = 1}^n\left[ \frac{X_i \hat{S}^i(t) - (X_i -
g(\boldsymbol{Z}_i,
\hat{\boldsymbol{\alpha}}))\hat{v}_i(1)}{g(\boldsymbol{Z}_i,
\hat{\boldsymbol{\alpha}})} - \frac{(1 - X_i) \hat{S}^i(t) + (X_i -
g(\boldsymbol{Z}_i, \hat{\boldsymbol{\alpha}}))\hat{v}_i(0)}{1 -
g(\boldsymbol{Z}_i, \hat{\boldsymbol{\alpha}})}\right].$$ Although Wang
proposed a variance estimator, it was found to be biased upward, and they
suggest instead using bootstrap variance estimation. Thus, we implement the
bootstrap variance estimator.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wang, J. A simple, doubly robust, efficient estimator for survival functions using pseudo observations. Pharmaceutical Statistics. 2018; 17: 38–48. https://doi.org/10.1002/pst.1834</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">rotterdam</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">rtime</span>, <span class="va">df</span><span class="op">$</span><span class="va">dtime</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365.25</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">recur</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">df</span><span class="op">$</span><span class="va">death</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">censor</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">df</span><span class="op">$</span><span class="va">status</span></span></span>
<span class="r-in"><span><span class="va">drFit</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">pseudo_survdiff</span><span class="op">(</span></span></span>
<span class="r-in"><span>    oformula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">chemo</span> <span class="op">+</span> <span class="va">year</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="va">size</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">+</span> <span class="va">nodes</span> <span class="op">+</span> <span class="va">pgr</span> <span class="op">+</span> <span class="va">er</span> <span class="op">+</span> <span class="va">hormon</span>,</span></span>
<span class="r-in"><span>    cformula <span class="op">=</span> <span class="op">~</span> <span class="va">chemo</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span> <span class="va">size</span>,</span></span>
<span class="r-in"><span>    eformula <span class="op">=</span> <span class="va">chemo</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span> <span class="va">size</span> <span class="op">+</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">+</span> <span class="va">nodes</span> <span class="op">+</span> <span class="va">pgr</span> <span class="op">+</span> <span class="va">er</span> <span class="op">+</span> <span class="va">hormon</span>,</span></span>
<span class="r-in"><span>    times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">7.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">df</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">drFit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $est.S1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.7814539 0.6209512 0.5389184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.S1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.02069071 0.02328108 0.02573691</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $est.S0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.7264196 0.5509058 0.4616483</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.S0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.01198071 0.01080776 0.01184234</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $est.diff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.05503432 0.07004544 0.07727005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.diff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.02624473 0.02512435 0.02745386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michael C Sachs, Arvid Sjölander, Erin E Gabriel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

